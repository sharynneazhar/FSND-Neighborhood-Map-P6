"use strict";function loadMapScript(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src=GMAP_FULL_URL,document.body.appendChild(e)}var PERSONALS={home:{title:"Home",lat:38.951979,"long":-94.837693,address:"21606 W 97th Terrace, Lenexa, KS 66220"},work:{title:"PayIt, LLC",lat:39.090509,"long":-94.589111,streetAddress:"1812 Broadway Blvd, Kansas City, MO 66213"},school:{title:"University of Kansas",lat:38.956572,"long":-95.244782,streetAddress:"1425 Jayhawk Blvd, Lawrence, KS 66045"}},FS_ID="1GOXWBOA2FOS31OFVOFRNSF0OKSXFZHDLNK000TL4UH2TREM",FS_SECRET="F0RQFWMRFTTC4VLCNEXZEG5OSY42YVCS4Z3JJ5AL0C40QPY3",FS_BASE_URL="https://api.foursquare.com/v2/venues",FoursquareService={getVenues:function(e){var o=GoogleMapsService.currentLocation.lat+","+GoogleMapsService.currentLocation.lng,t=FS_BASE_URL+"/search?client_id="+FS_ID+"&client_secret="+FS_SECRET+"&v=20130815&ll="+o+"&limit=10&query="+e,a=[];$.getJSON(t,function(e){var o=e&&200===e.meta.code&&e.response.venues.length>0;o&&($.each(e.response.venues,function(e,o){var t={id:o.id,title:o.name,contact:o.contact.formattedPhone||"",url:o.url||"",lat:o.location.lat,"long":o.location.lng,address:o.location.formattedAddress};a.push(t)}),GoogleMapsService.showMarkers(a))})}},GMAP_KEY="?key=AIzaSyCKioYCg26ODl5A4Z2K03OFkXJRT1mBpRk",GMAP_BASE_URL="http://maps.googleapis.com/maps/",GMAP_FULL_URL=GMAP_BASE_URL+"api/js"+GMAP_KEY+"&libraries=places&callback=GoogleMapsService.init",GMAP_QUERY_URL=GMAP_BASE_URL+"api/place/queryautocomplete/json"+GMAP_KEY+"&input=",DIMS={height:$(window).height(),width:$(window).width()},map=null,markers=[],GoogleMapsService={init:function(){var e=document.getElementById("map"),o={zoom:DIMS.width<662?10:12,center:new google.maps.LatLng(39.0997,(-94.5786)),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1};map=new google.maps.Map(e,o),this.getCurrentLocation();var t=map.getStreetView();t.addListener("visible_changed",function(){t.getVisible()?$("#searchbar").css("display","none"):$("#searchbar").css("display","flex")})},getMarkers:function(e){$.each(e,function(e,o){var t=new google.maps.Marker({title:o.title,position:new google.maps.LatLng(o.lat,o["long"]),map:map,animation:google.maps.Animation.DROP}),a='<div id="venue"><div class="venue-name">'+o.title+'</div><div class="venue-url"><a href="'+o.url+'"> '+o.url+'</a></div><div class="venue-address">'+o.address[0]+"<br>"+o.address[1]+'</div><div class="venue-contact">'+o.contact+"</div></div>",n=new google.maps.InfoWindow({content:a});t.addListener("click",function(){null!==t.getAnimation()?t.setAnimation(null):(t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null)},750)),n.open(map,t)}),markers.push(t)})},showMarkers:function(e){this.getMarkers(e);var o=new google.maps.LatLngBounds;$.each(markers,function(e,t){o.extend(t.getPosition()),t.setMap(map)}),map.fitBounds(o)},clearMarkers:function(){$.each(markers,function(e,o){o.setMap(null)}),markers=[]},getCurrentLocation:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o={lat:e.coords.latitude,lng:e.coords.longitude},t=new google.maps.Marker({title:"You Are Here",position:new google.maps.LatLng(o),map:map,animation:google.maps.Animation.DROP});Splash.isRunning()&&setTimeout(function(){$("#loader").fadeOut("slow",function(){Splash.destroy()})},3e3),map.getBounds().contains(t.getPosition())||map.panTo(t.getPosition()),GoogleMapsService.currentLocation=o},function(){console.log("Oops, we were unable to retrieve your current location."),Splash.isRunning()&&setTimeout(function(){$("#loader").fadeOut("slow",function(){Splash.destroy()})},3e3)}):(console.log("Your browser does not support geolocation."),Splash.isRunning()&&setTimeout(function(){$("#loader").fadeOut("slow",function(){Splash.destroy()})},3e3))}};loadMapScript();var ViewModel=function(){var e=this;e.searchAddress=ko.observable(""),this.searchLocation=function(){var o=e.searchAddress();GoogleMapsService.clearMarkers(),FoursquareService.getVenues(o),e.searchAddress(""),$("input").blur()}};ko.applyBindings(new ViewModel);