"use strict";function nonceString(e){for(var a="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<e;t++)a+=n.charAt(Math.floor(Math.random()*n.length));return a}function stopLoading(){Splash.isRunning&&Splash.destroy()}function setMarkers(e){clearMarkers(),$.each(e,function(e,a){createMarker(a)})}function clearMarkers(){$.each(markerArray,function(e,a){a.setMap(null)}),markerArray=[]}function createMarker(e){var a,n=new google.maps.LatLng(e.lat,e.lng),t=new google.maps.Marker({position:n,map:map,animation:google.maps.Animation.DROP});a=""===e.url?'">':(e.url||"#")+'" target="_blank">Visit Website';var o='<div id="venue"><h5 class="venue-name">'+(e.name||"")+'</h5><div class="venue-address">'+(e.address[0]||"")+"<br>"+(e.address[2]||e.address[1]||"")+'</div><div class="venue-contact">'+(e.phone||"")+'</div><div class="venue-url"><a href="'+a+'</a></div><div class="venue-rating" style="margin-top:10px"><img src="'+(e.ratingImage||"")+'" /></div></div>';google.maps.event.addListener(t,"click",function(){null!==t.getAnimation()?t.setAnimation(null):(t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null)},750)),infoWindow.setContent(o),infoWindow.open(map,t)}),markerArray.push(t)}function getYelpData(e){$.each(e,function(e,a){var n={oauth_consumer_key:YELP_CONSUMER_KEY,oauth_token:YELP_TOKEN,oauth_nonce:nonceString(15),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:a.name,location:"Kansas City, MO",limit:1};n.oauth_signature=oauthSignature.generate("GET",YELP_BASE_URL,n,YELP_CONSUMER_SECRET,YELP_TOKEN_SECRET),$.ajax({url:YELP_BASE_URL,data:n,cache:!0,async:!0,dataType:"jsonp",success:function(e){var n=e.businesses[0],t={id:n.id||"",name:n.name||a.name,phone:n.display_phone||"",url:n.url||"",lat:n.location.coordinate.latitude||a.lat,lng:n.location.coordinate.longitude||a.lng,address:n.location.display_address||a.address,ratingImage:n.rating_img_url||""};yelpLocations.push(t)},complete:function(){7===yelpLocations.length&&(setMarkers(yelpLocations),vm.locations(yelpLocations),stopLoading())},error:function(e){alert("Oops, something went wrong requesting from Yelp. Please try again!")}})})}function initialize(){Splash.enable("circular");var e=document.getElementById("map"),a={zoom:DIMS.width<662?10:16,center:new google.maps.LatLng(CURRENT_LOCATION.lat,CURRENT_LOCATION.lng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1};return infoWindow=new google.maps.InfoWindow,new google.maps.Map(e,a)}var Splash=window.Splash,DIMS={height:$(window).height(),width:$(window).width()},LOCATIONS=[{name:"Town Topic",lat:39.088453,lng:-94.588779,address:["2021 Broadway St","Kansas City, MO 64108"]},{name:"PT's Coffee",lat:39.088554,lng:-94.588155,address:["310 Southwest Blvd","Kansas City, MO 64108"]},{name:"Lulu's Thai Noodle Shop",lat:39.087739,lng:-94.58791,address:["2030 Central St","Kansas City, MO 64108"]},{name:"Mildred's Coffeehouse",lat:39.091076,lng:-94.585831,address:["1821 Wyandotte St","Kansas City, MO 64108"]},{name:"Sylvia's Deli",lat:39.091376,lng:-94.589991,address:["1746 Washington St","Kansas City, MO 64108"]},{name:"Jack Stack BBQ - Freight House",lat:39.087583,lng:-94.585039,address:["101 W 22nd St #300","Kansas City, MO 64108"]},{name:"Coda",lat:39.091239,lng:-94.589067,address:["1744 Broadway St","Kansas City, MO 64108"]},{name:"Extra Virgin",lat:39.090187,lng:-94.58404,address:["1900 Main St","Kansas City, MO 64108"]}],YELP_BASE_URL="http://api.yelp.com/v2/search/",YELP_CONSUMER_KEY="TvJZDsVoUcBof1g4Vupo0Q",YELP_CONSUMER_SECRET="PEW3KTxsoUUGWROFC0vpzs2O2GM",YELP_TOKEN="eZugQLtOZa7f0ZV2VXRNb76pjTZrUT0T",YELP_TOKEN_SECRET="j-DHHnxNR7bvRpc5K7VqdLqmcDc",CURRENT_LOCATION={lat:39.090509,lng:-94.589111},yelpLocations=[],markerArray=[],infoWindow,map=initialize();map||alert("Oops, something went wrong with Google Maps. Please try again later!"),getYelpData(LOCATIONS);var ViewModel=function(){var e=this;e.locationFilter=ko.observable(),e.locations=ko.observableArray([]),e.filteredLocations=ko.observableArray([]),e.filteredVisible=ko.observable(!1),e.menuVisible=ko.observable(!1),e.filter=function(){Splash.enable("circular"),e.filteredLocations([]);var a=e.locationFilter().toLowerCase();""===e.locationFilter()&&(e.toggle(),setMarkers(e.locations())),$.each(e.locations(),function(n,t){var o=t.name.toLowerCase();if(o.indexOf(a)>=0){e.toggle();var i={name:t.name,address:t.address,phone:t.phone,lat:t.lat,lng:t.lng,url:t.url,ratingImage:t.ratingImage};e.filteredLocations.push(i)}}),e.filteredLocations().length>0?(setMarkers(e.filteredLocations()),stopLoading()):alert("No locations found")},e.openInfo=function(){e.toggle(),Splash.enable("circular");var a=[{name:this.name,address:this.address,phone:this.phone,lat:this.lat,lng:this.lng,url:this.url,ratingImage:this.ratingImage}];setMarkers(a),stopLoading()},e.toggle=function(){e.menuVisible()&&e.toggleMenu(),e.filteredVisible(!e.filteredVisible())},e.toggleMenu=function(){e.filteredVisible()&&e.toggle(),e.menuVisible(!e.menuVisible())}},vm=new ViewModel;ko.applyBindings(vm);