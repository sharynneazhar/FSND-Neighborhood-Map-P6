"use strict";function loadMapScript(){var e=document.createElement("script");e.async=!0,e.type="text/javascript",e.src=GMAP_FULL_URL,document.body.appendChild(e)}function nonceString(e){for(var a="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}var LOCATIONS=[{name:"Town Topic",lat:39.088453,lng:-94.588779,address:["2021 Broadway St","Kansas City, MO 64108"]},{name:"PT's Coffee",lat:39.088554,lng:-94.588155,address:["310 Southwest Blvd","Kansas City, MO 64108"]},{name:"Lulu's Thai Noodle Shop",lat:39.087739,lng:-94.58791,address:["2030 Central St","Kansas City, MO 64108"]},{name:"Mildred's Coffeehouse",lat:39.091076,lng:-94.585831,address:["1821 Wyandotte St","Kansas City, MO 64108"]},{name:"Sylvia's Deli",lat:39.091376,lng:-94.589991,address:["1746 Washington St","Kansas City, MO 64108"]}],DIMS={height:$(window).height(),width:$(window).width()},GMAP_KEY="?key=AIzaSyCKioYCg26ODl5A4Z2K03OFkXJRT1mBpRk",GMAP_BASE_URL="http://maps.googleapis.com/maps/",GMAP_FULL_URL=GMAP_BASE_URL+"api/js"+GMAP_KEY+"&libraries=places&callback=LocationService.init",GMAP_QUERY_URL=GMAP_BASE_URL+"api/place/queryautocomplete/json"+GMAP_KEY+"&input=",YELP_BASE_URL="http://api.yelp.com/v2/search/",YELP_CONSUMER_KEY="TvJZDsVoUcBof1g4Vupo0Q",YELP_CONSUMER_SECRET="PEW3KTxsoUUGWROFC0vpzs2O2GM",YELP_TOKEN="eZugQLtOZa7f0ZV2VXRNb76pjTZrUT0T",YELP_TOKEN_SECRET="j-DHHnxNR7bvRpc5K7VqdLqmcDc",map=null,markerObjects=[],markers=[],LocationService={currentLocation:{lat:39.090509,lng:-94.589111},init:function(){var e=document.getElementById("map"),a={zoom:DIMS.width<662?10:12,center:new google.maps.LatLng(this.currentLocation.lat,this.currentLocation.lng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1};map=new google.maps.Map(e,a),LocationService.getYelpData(LOCATIONS),setTimeout(function(){LocationService.showMarkers(markerObjects)},3e3)},createMarkers:function(e){var a=new google.maps.InfoWindow;$.each(e,function(e,t){var n=new google.maps.Marker({title:t.name,position:new google.maps.LatLng(t.lat,t.lng),map:map,animation:google.maps.Animation.DROP}),o='<div id="venue"><div class="venue-name">'+(t.name||"")+'</div><div class="venue-url"><a href="'+(t.url||"")+'">Visit Website</a></div><div class="venue-address">'+(t.address[0]||"")+"<br>"+(t.address[2]||t.address[1]||"")+'</div><div class="venue-contact">'+(t.contact||"")+'</div><div class="venue-rating">'+(t.rating||"")+'<img src="'+(t.ratingImage||"")+'" /></div></div>';google.maps.event.addListener(n,"click",function(){null!==n.getAnimation()?n.setAnimation(null):(n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null)},750)),a.setContent(o),a.open(map,n)}),markers.push(n)})},showMarkers:function(e){this.createMarkers(e);var a=new google.maps.LatLngBounds;$.each(markers,function(e,t){a.extend(t.getPosition()),t.setMap(map)}),map.fitBounds(a)},clearMarkers:function(){$.each(markers,function(e,a){a.setMap(null)}),markers=[]},getYelpData:function(e){$.each(e,function(e,a){var t={oauth_consumer_key:YELP_CONSUMER_KEY,oauth_token:YELP_TOKEN,oauth_nonce:nonceString(15),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:a.name,location:"Kansas City, MO",limit:1},n=oauthSignature.generate("GET",YELP_BASE_URL,t,YELP_CONSUMER_SECRET,YELP_TOKEN_SECRET);t.oauth_signature=n,$.ajax({url:YELP_BASE_URL,data:t,cache:!0,dataType:"jsonp",success:function(e){var t=e.businesses[0],n={id:t.id||"",name:t.name||a.name,phone:t.display_phone||"",url:t.url||"",lat:t.location.coordinate.latitude||a.lat,lng:t.location.coordinate.longitude||a["long"],address:t.location.display_address||a.address,rating:t.rating||"",ratingImage:t.rating_img_url||""};markerObjects.push(n)},error:function(e){console.log(e)}})})}};loadMapScript();var Location=function(e){this.id=ko.observable(e.id),this.name=ko.observable(e.name),this.phone=ko.observable(e.phone),this.address=ko.observable(e.address),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.url=ko.observable(e.url),this.rating=ko.observable(e.rating),this.ratingImage=ko.observable(e.image);var a=new google.maps.Marker({title:this.name(),position:new google.maps.LatLng(this.lat(),this.lng()),map:map});this.marker=ko.observable(a)},ViewModel=function(){var e=this;e.locationFilter=ko.observable(""),e.filteredLocations=ko.observable([]),e.filter=function(){console.log("Filtering ",e.locationFilter())}};ko.applyBindings(new ViewModel);